<!-- Imports polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Defines element markup -->
<dom-module id="gs-game">

    <template>
        <style></style>
        <div id="gameState">Je suis en game </div>
    </template>

    <!-- Registers custom element -->
    <script>
        Polymer({
            is: 'gs-game',

            properties: {
                gameKey: {
                    type: String,
                    value: undefined
                },
                playerId:{
                    type:String,
                    value: undefined
                },
                _socket: {
                    type: Object,
                    value: null
                }
            },
            observers:[
                '_gameIdChanged(gameKey, playerId)'
            ],
            _gameIdChanged: function () {
                if (this._socket) {
                    this._socket.close();
                }
                this._socket = new WebSocket('ws://localhost:26001');

                this._socket.addEventListener('open', function (event) {
                    this._socket.send(this.gameKey+":"+this.playerId);
                }.bind(this));

                // Listen for messages
                this._socket.addEventListener('message', function (event) {
                    console.log('Message from server', event.data);
                    this._updateGameState(event.data)
                }.bind(this));
            },
            _updateGameState: function (gameState) {
                this.$.gameState.innerHTML = gameState;
            }
        });
    </script>
</dom-module>